<article>
  <h1 id=io>Input &amp; Output</h1>

  <!-- The Standard Trinity: In, Error, Out-->
<!--  
def with_verbosity(verbosity=false)
  old, $VERBOSE = $VERBOSE, verbosity
  yield
ensure
  $VERBOSE = old
end

def quietly(&block)
  with_verbosity(nil, &block)
end
def loudly(&block)
  with_verbosity(true, &block)
end
-->  
  <section>
    <h1 id=files>Files</h1>

    <p>A file is an entity on a filesystem addressable by a <a
      href=#file-paths>path</a>. This definition is intentionally
    broad-encompassing regular files along with directories, block and
    character devices, symbolic links, sockets, and <abbr title='First-In
      First-Out'>FIFO</abbr>s (named pipes)-because the <code>File</code>
    class represents them all. It is this class that is the subject of our
    present enquiry.</p>

    <!-- Describe the mode argument accepted by `open` as the 'open mode'?
    This clarifies the distinction between the mode argument, textmode, and
    binmode. -->

    <p>A <code>File</code> object may be created with the constructor
    <code>File.new</code>, which expects an existing path as an argument. The
    objectified file can then be interrogated, and its contents <a
      href=#file-read>read</a>. The <code>File</code> objects instantiated by <a
      href=#file-open><code>Kernel.open</code></a> can be written to, as well
    as read, with their underlying file being created if needed.

    <!-- Contrast File class methods with instance methods. Introduce testing
    methods up here, then expound on them later. -->
    <!-- TODO: Dir -->

    <!-- Summary table?
    File.read
    File.binread
    File.exist?
    open(path, ?w)
    open(path, ?a, encoding: 'from:to')
    File.delete
    File.rename
    File.file?
    File.size?
    File.ctime/mtime/..
    File.new()
    File.symlink
    -->
    <section>
      <h1 id=file-paths>Paths</h1>
    
      <p>A file’s <dfn>path</dfn> is a <code>String</code> describing its
      location in the filesystem. It consists of one or more
      <dfn>components</dfn>, which in the latter case are separated with the
      <dfn>path separator</dfn>. On non-Windows platforms the path separator
      is the solidus character. <!-- Solidus used as path sep. on Windows,
      too, but on Windows Ruby can also handle native paths -->

      <p>We use the term <i>path</i> to refer either to a <code>String</code>,
      whose contents is a path, or an object that responds to
      <code>:to_path</code> with such a <code>String</code>. A method that
      expects a path as an argument will accept either of these
      representations.

      <!-- TODO: Define what we mean by path normalisation -->

      <p><code>File.path</code> returns the non-normalised path of its
      argument. If its argument is a <code>String</code>, it will be returned
      as-is, otherwise the result of sending the argument
      <code>:to_path</code> will be returned. The path associated with a
      <code>File</code> object is returned by <code>File#path</code>.

      <code>File.dirname</code> returns the directory name of its argument:
      all components other than the last. Conversely, the last component of
      a filename is returned by <code>File.basename</code>. The filename
      extension, e.g. <code>.txt</code>, is returned by
      <code>File.extname</code>. If these methods are given a path without
      the requested component, they return the empty <code>String</code>.
      <code>File.split</code> returns a two-element <code>Array</code> with
      the file’s dirname as the first element, and its basename as the last.
      <code>File.join</code> performs the inverse operation: given a list of
      path components it joins them with the path separator into a
      <code>String</code>.
      
      <table class=border>
        <caption>
          <p>Examples of how path components are interpreted by the named
          class methods of <code>File</code>
          <p>Each column indicates the output of the corresponding
          <code>File</code> class method for the path given in the first
          column.
        </caption>
        <thead>
          <tr>
            <th><code>path</code>
            <th><code>dirname</code>
            <th><code>basename</code>  
            <th><code>extname</code>  
            <th><code>split</code>  
        <tbody class=zebra>
          <tr>
            <td><code>/home/user/base64.rb</code>
            <td><code>/home/user</code>  
            <td><code>base64.rb</code>  
            <td><code>.rb</code>  
            <td><code>["/home/user", "base64.rb"]</code>
          <tr>
            <td><code>/etc/hosts</code>
            <td><code>/etc</code>  
            <td><code>hosts</code>  
            <td>&nbsp;  
            <td><code>["/etc", "hosts"]</code>
          <tr>
            <td><code>sort</code>
            <td><code>.</code>  
            <td><code>sort</code>  
            <td>&nbsp;  
            <td><code>[".", "sort"]</code>
          <tr>
            <td><code>~/.vimrc</code>
            <td><code>~</code>  
            <td><code>.vimrc</code>  
            <td>&nbsp;  
            <td><code>["~", ".vimrc"]</code>
      </table>

      <p>A <dfn>relative path</dfn> is a path given in terms of another
      path, as opposed to an <dfn>absolute path</dfn> which stands alone. On
      Unix-like systems, the former are paths that do not begin with a
      solidus, and the latter are the opposite. 
      
      <p>A relative path may be expanded to an absolute path with
      <code>File.expand_path</code>. Absolute paths are returned as-is.
      Otherwise, they are assumed to be relative to the current directory. If
      an optional second argument is given, it names the directory the first
      argument is relative to. If the relative path begins with a tilde, it is
      interpreted as relative to the current user’s home directory (as
      returned by <code>ENV['HOME']</code>). If the relative path begins with
      a tilde followed by a username, it is relative to the named user’s home
      directory. <code>File.absolute_path</code> behaves in the same fashion
      except it doesn’t treat tildes specially, i.e. it interprets a path of
      <code>~/glark</code> as <code>./~/glark</code>.</p>

      <figure id=file-expand-path.rb>
        <figcaption><code>File.expand_path</code> resolves relative paths
        into absolute paths.
      </figure>
      
      <p>Neither <code>File.absolute_path</code> nor
      <code>File.expand_path</code> resolve relative paths by traversing the
      filesystem: at most, they request the current working directory or a
      user’s home directory from the environment. An implication is that they
      will quite happily return paths that do not exist on the filesystem.
      <code>File.realpath</code> is an alternative. It creates an absolute
      path from a relative path by interrogating the filesystem, and following
      symbolic links if necessary. It resolves relative to the current working
      directory, or the directory given by the optional second argument. An
      exception is raised if the absolute path it resolves does not exist.
      <code>File.realdirpath</code> accepts the same arguments, and performs
      the same operation, but allows the last component of the path to be
      non-existent.</p>

      <figure id=file-realpath.rb>
        <figcaption><code>File.realpath</code> and
        <code>File.realdirpath</code> resolve relative paths by walking the
        filesystem.
      </figure>
    </section>

    <section>
      <h1 id=file-read>Reading</h1>

      <!-- Move this after Opening? -->
      <p>Reading a file is the process of retrieving its contents. It can be
      achieved by passing a path argument to <code>File.read</code> which
      returns the contents as a <code>String</code>. An optional second
      argument specifies the number of bytes to read, and an optional third
      argument specifies the offset from which to begin reading. An options
      <code>Hash</code> may be supplied as the final argument, which is
      explained in the <a href=#file-open>Opening</a> section below.
      <code>File.binread</code> takes the same arguments but reads the file in
      <a href=#binmode>binary mode</a>.</p>

      <figure id=file-read.rb>
        <figcaption>Reading a file with <code>File.read</code>
      </figure>
    </section>

    <!-- 'Writing' section for symmetry? Show implementation of File.write? -->
    <section>
      <h1 id=file-open>Opening</h1>

      <p>Opening a file enables one to read from, write to, or otherwise
      manipulate and query, the resource. <code>Kernel.open</code> opens the
      file with the given path, returning a corresponding <code>File</code>
      object. It is typically used with a block, which receives the opened
      <code>File</code> object as an argument.  Having executed the block, the
      file is automatically closed, even if the block raises an exception.
      <!-- Return value is that of the block -->

      <p>The second argument of <code>Kernel.open</code> may be a
      <code>Hash</code> of options. This is summarised in the table that
      follows, then expounded upon below.</p>

      <figure id=kernel-open-opts.rb>
        <figcaption>Creating, appending to, and reading from a file.
      </figure>

      <table class=border>
        <caption>Options that may be specified as the second argument to
          <code>Kernel.open</code>. Options accepted by <a
            href=/text#encode-options-hash><code>String#encode</code></a> are
          also accepted.
        </caption>
        <thead>
          <tr>
            <th>Key
            <th>Value
            <th>Default value    
            <th>Description
          <tbody class=zebra>
            <tr>
              <td><a href=#file-mode><code>:mode</code></a>
              <td>The mode as a <code>String</code>. <!-- or int? -->
              <td><code>r</code>  
              <td>Whether to open the file in read-only, read-write, or
                write-only mode, and whether to truncate existing files or
                append to them.  
            <tr>
              <td><a href=#textmode><code>:textmode</code></a>
              <td><code>true</code> or <code>false</code>
              <td><code>false</code>  
              <td>Whether to perform newline conversion.
            <tr>
              <td><a href=#binmode><code>:binmode</code></a>
              <td><code>true</code> or <code>false</code>
              <td><code>false</code>  
              <td>Whether to treat the file as a stream of bytes.
            <tr>
              <td><code>:perm</code>
              <td><code>Integer</code>
              <td>Platform-specific
              <td>The permissions the file should be created with.
            <tr>
              <td><code>:external_encoding</code>
              <td><code>Encoding</code> object or encoding name
              <td><code>Encoding.default_external</code>
              <td>The external encoding to apply to the stream.
            <tr>
              <td><code>:internal_encoding</code>
              <td>〃  
              <td><code>Encoding.default_internal</code>
              <td>The external encoding to apply to the stream.
            <tr>
              <td><code>:encoding</code>
              <td>Encoding name or two names separated by a colon. 
              <td><code><var>default_external</var>:<var>default_internal</var></code>
              <td>The external, or external and internal, encodings to apply
                to the stream.
            <tr>
              <td><code>:autoclose</code>
              <td><code>true</code> or <code>false</code> 
              <td><code>true</code> 
              <td>Whether to automatically close the file descriptor when the
                  <code>File</code> object is finalised.
      </table>

      <section>
        <h1 id=file-mode>Mode</h1>

        <p>A file is opened with a particular <dfn>mode</dfn> which specifies
        the type of action to be performed on it. The default mode is
        <code>r</code>. The available modes are listed
        in the following table.

        <table class=border>
          <caption>
            <p>Mode specifiers accepted by <code>Kernel.open</code>,
            <code>File.open</code>, and <code>IO.open</code>.  <p><i>Mode</i>
            is the mode string. The <i>Read?</i> and <i>Write?</i> columns
            indicate whether the opened file can be read from or written to,
            respectively. <i>Truncate?</i> specifies that existing files will
            be truncated before use. <i>Creates?</i> specifies that
            non-existent files will be created before use. Finally, <i>Start
              Position</i> is the position in the file reading/writing starts
            from:
            <i>Beginning</i> is before the first byte; <i>End</i> is after the
            last.
          </caption>
          <thead>  
            <tr>
              <th>Mode
              <th title='Opened for reading?'>Read?
              <th title='Opened for writing?'>Write?
              <th title='Truncated if it exists?'>Truncates?
              <th title='Created if it doesn’t exist?'>Creates?
              <th title='Where reading/writing starts from'>Start Position
          <tbody class=zebra>
            <tr>
              <td><code>r</code>
              <td>✔
              <td>✖
              <td>✖
              <td>✖
              <td>Beginning.
            <tr>
              <td><code>r+</code>
              <td>✔
              <td>✔
              <td>✖
              <td>✖
              <td>〃  
            <tr>
              <td><code>w</code>
              <td>✖
              <td>✔
              <td>✔
              <td>✔
              <td>〃  
            <tr>
              <td><code>w+</code>
              <td>✔
              <td>✔
              <td>✔
              <td>✔
              <td>〃  
            <tr>
              <td><code>a</code>
              <td>✖
              <td>✔
              <td>✖
              <td>✔
              <td>End.
            <tr>
              <td><code>a+</code>
              <td>✔
              <td>✔
              <td>✖
              <td>✔
              <td>〃  
        </table>
      </section>

      <p>Independently of the mode specifiers given above, a file may be
      opened in <dfn>binary mode</dfn>, <dfn>text mode</dfn>, or neither.</p>

      <section>
        <h1 id=binmode>Binary Mode</h1>
        
        <p>Binary mode is disabled by default. It must be enabled when
        reading a file with an ASCII-incompatible external encoding. When
        enabled it has the following effects:

        <ul>
          <li>Unless an external encoding has been specified explicitly, it
          is set to ASCII-8BIT.
          <li><a href=#text-mode>Newline conversion</a> is disabled. <!-- Unless *_newline Hash
          key? -->
          <li>Transcoding is disabled unless both an internal and external
          encoding have been specified.
        </ul>  

        <!-- File.binread -->
      </section>

      <section>
        <h1 id=textmode>Text Mode</h1>
        
        <p>Text mode defaults to on under Windows, and off everywhere else.
        Reading a file in text mode causes <code>\r\n</code> to be replaced
        by <code>\n</code>, and other occurrences of <code>\r</code> to be
        replaced by <code>\n</code>. Writing a file in text mode causes
        <code>\n</code> to be replaced with <code>\r\n</code> under Windows;
        having no effect on other platforms.
      </section>

      <section>
        <h1 id=perm>Permissions</h1>
        
        <p>If a file is being created, its initial permissions may be
        specified as an <code>Integer</code>. On Unix-based systems, these
        permissions bits are interpreted in the same fashion that
        <code>chmod(1)</code> interprets octal mode arguments. For example,
        <code>perm: 0400</code> gives the user read permission, and no
        permissions to anybody else. Permissions are covered in more detail in
        the <a href=#file-permissions>Permissions</a> section below.
      </section>

      <section>
        <h1 id=open-external-encoding>External Encoding</h1>
        
        <p>The external encoding is the encoding associated with the file’s
        contents. Its default value is <code>Encoding.default_external</code>.
        Data read from the file is tagged with this encoding. The external
        encoding may be set explicitly by providing its name, or its
        corresponding <code>Encoding</code> object, as the value of
        the <code>:external_encoding</code> key.

        <p>When a file is opened in <a href=#binmode>binary mode</a>, its
        external encoding defaults to ASCII-8BIT, unless specified explicitly.
        An external encoding that is ASCII-incompatible requires the file to
        be opened in binary mode.
      </section>

      <section>
        <h1 id=open-internal-encoding>Internal Encoding</h1>

        <p>The internal encoding is the encoding the programmer wishes to
        associate with the file’s data. The value of the
        <code>:internal_encoding</code> key is specified as an encoding name
        or <code>Encoding</code> object.
        
        <p>If this encoding differs from the file’s external encoding, Ruby
        will automatically transcode it: when both an internal and external
        encoding are specified, data read from the file is transcoded from
        external to internal, and data written to the file is transcoded from
        internal to external. The default internal encoding is
        <code>Encoding.default_internal</code>. An internal encoding of
        <code>nil</code>-which is the default value-prevents any automatic
        transcoding.
      </section>

      <section>
        <h1 id=open-encoding>Encoding</h1>

        <p>The <code>:encoding</code> key allows one or both of the external
        encoding and internal encoding to be specified at once in one of the
        forms below.

        <table class=border>
          <caption>
            <p>The forms the value of the <code>:encoding</code> key may take.
            <p>Both <var>external</var> and <var>internal</var> are names of
            encodings. The <i>Inferred from BOM</i> column indicates that the
            external encoding is set to that specified by a <abbr
              title='Byte-Order Mark'>BOM</abbr>, if present, otherwise to the
            named encoding. 
          </caption>
          <thead>  
            <tr>
              <th>Form
              <th colspan=2>External Encoding
              <th>Internal Encoding    
            <tr>
              <th>&nbsp;
              <th>Value
              <th>Inferred from BOM?    
              <th>Value    
          <tbody>        
            <tr class=odd>
              <td><code><var>external</var></code>
              <td rowspan=2><var>external</var>
              <td rowspan=2>✖
              <td rowspan=2><code>Encoding.default_internal</code>
            <tr class=odd>
              <td><code><var>external</var>:-</code>
            <tr>
              <td><code>BOM|<var>external</var></code>
              <td rowspan=2><var>external</var>
              <td rowspan=2>✔
              <td rowspan=2><code>Encoding.default_internal</code>
            <tr>
              <td><code>BOM|<var>external</var>:-</code>
            <tr class=odd>
              <td><code><var>external</var>:<var>internal</var></code>
              <td><var>external</var>
              <td>✖
              <td><var>internal</var>
            <tr>
              <td><code>BOM|<var>external</var>:<var>internal</var></code>
              <td><var>external</var>
              <td>✔
              <td><var>internal</var>
            <tr class=odd>
              <td><code>:<var>internal</var></code>
              <td>Default external
              <td>✖
              <td><var>internal</var>
        </table>
        
        <p>The <code>BOM|</code> prefix deserves a fuller explanation. The
        UTF-8, UTF-16BE, UTF-16LE, UTF-32BE, and UTF-32LE encodings support
        the presence of a byte-order mark: a special character occuring at
        the start of the stream which indicates the byte order of the
        encoding. This can be used to distinguish between the big-endian and
        little-endian forms of UTF-16, for example. Prefixing one of the
        aforementioned encoding names with the case-insensitive string
        <code>BOM|</code> has the following result:

        <ul>
          <li>If no BOM is present, the named encoding is used.
          <li>If a BOM is present, the encoding that it specifies is used
          instead of the named encoding, and the BOM is stripped from the
          data.
        </ul>

        <table class=border>
          <caption>Encodings that support byte-order marks, and the content of
            the corresponding BOM.</caption>
          <thead>  
            <tr>
              <th>Encoding
              <th>Byte-Order Mark
          <tbody class=zebra>        
            <tr>
              <td>UTF-8
              <td><code>\xEF\xBB\xBF</code>  
            <tr>
              <td>UTF-16BE
              <td><code>\xFE\xFF</code>  
            <tr>
              <td>UTF-16LE
              <td><code>\xFF\xFE</code>  
            <tr>
              <td>UTF-32BE
              <td><code>\0\0\xFE\xFF</code>  
            <tr>
              <td>UTF-32LE
              <td><code>\xFF\xFE\0\0</code>  
          </table>
      </section>

      <section>
        <h1 id=mode-string>The Mode String</h1>

        <p>There is an alternative way to specify many of the options
        described above called a <dfn>mode string</dfn>. It may be provided as
        the second argument to <code>Kernel.open</code> as a
        <code>String</code>, or given as the value of the <code>:mode</code>
        key in the options <code>Hash</code>. While the mode string is more
        concise than the options <code>Hash</code>, it is also more cryptic
        when specifying multiple options.

        <table class=border>
          <caption>
            <p>The forms a mode string may take.  <p><var>mode</var> denotes
            one of the modes given in the <a href=#file-mode>modes</a> table.
            The <i>Binary?</i> and <i>Text?</i> columns indicates whether the
            stream is in binary or text mode, respectively. Both
            <var>internal</var> and <var>external</var> are names of
            encodings.
          </caption>
          <thead>  
            <tr>
              <th>Form
              <th>Binary?  
              <th>Text?  
              <th>External Encoding  
              <th>Internal Encoding  
          <tbody class=zebra>        
            <tr>
              <td><code><var>mode</var></code>
              <td>✖
              <td>✖
              <td><code>Encoding.default_external</code>
              <td><code>Encoding.default_internal</code>
            <tr>
              <td><code><var>mode</var>t</code>
              <td>✖
              <td>✔
              <td>〃  
              <td>〃  
            <tr>
              <td><code><var>mode</var>b</code>
              <td>✔
              <td>✖
              <td><code>ASCII-8BIT</code>
              <td>〃  
            <tr>
              <td><code><var>mode</var>:<var>external</var></code>
              <td>✖
              <td>✖
              <td><var>external</var>
              <td>〃  
            <tr>
              <td><code><var>mode</var>t:<var>external</var></code>
              <td>✖
              <td>✔
              <td>〃  
              <td>〃  
            <tr>
              <td><code><var>mode</var>b:<var>external</var></code>
              <td>✔
              <td>✖
              <td>〃  
              <td>〃  
            <tr>
              <td><code><var>mode</var>:<var>external</var>:<var>internal</var></code>
              <td>✖
              <td>✖
              <td>〃  
              <td><var>internal</var>
            <tr>
              <td><code><var>mode</var>t:<var>external</var>:<var>internal</var></code>
              <td>✖
              <td>✔
              <td>〃  
              <td>〃  
            <tr>
              <td><code><var>mode</var>b:<var>external</var>:<var>internal</var></code>
              <td>✔
              <td>✖
              <td>〃  
              <td>〃  
          </table>

          <!-- Include the other forms of the encoding string, e.g. BOM|? -->
          <p>For example, <code>r:ascii</code> reads from the beginning of a file,
          tagging the data it reads as US-ASCII; <code>a+:ascii:utf-8</code> opens
          the file for reading and appending, transcoding from US-ASCII to UTF-8
          when reading, and in the opposite direction when writing.
      </section>
      <!-- TODO: Discuss ORing constants to specify the open mode? -->
    </section>

    <!-- Iteration; or, cover this in terms of IO objects in general?  -->

    <section>
      <h1 id=file-exists>Existence</h1>

      <p>It is often necessary to determine whether a given file exists as
      methods that accept path arguments may raise exceptions otherwise.
      To this end Ruby provides the predicate <code>File.exists?</code>, and
      its alias <code>File.exist?</code>.
    </section>

    <section>
      <h1 id=file-delete>Deletion</h1>

      <p>Files may be deleted by supplying a list of their paths as arguments to
      <code>File.delete</code>, or its alias <code>File.unlink</code>. An
      <code>Integer</code> is returned indicating how many files were
      deleted. <!-- File.truncate -->
    </section>

    <!-- File.utime -->
    <section>
      <h1 id=file-rename>Renaming</h1>

      <p>Files may be renamed by invoking <code>File.rename</code> with
      their current path as the first argument, and their desired path as
      the second.
    </section>

    <section>
      <h1 id=file-size>Size</h1>

      <p>A file that exists has a size. The <code>File.size</code> method
      returns the size of its argument, and <code>File#size</code> returns
      that of its receiver. In both cases, the size is an <code>Integer</code>
      and in bytes. The <code>File.size?</code> predicate returns the size of
      the file named by its argument if it exists and has a non-zero size, or
      otherwise: <code>nil</code>. Similarly, <code>File.zero?</code> returns
      <code>true</code> if the file named by its argument exists and has a
      size of zero; <code>false</code> otherwise.
    </section>  
    
    <section>
      <h1 id=file-comparison>Comparison</h1>

      <p>The <code>File.identical?</code> predicate is used to determine
      whether the two files it is given as arguments are the same: returning
      <code>true</code> if they are, <code>false</code> otherwise. Two files
      are considered identical if their paths normalise to the same
      path, or if one or both are symbolic links with identical targets.
      It is not sufficient that two files merely contain the same content for
      this method to succeed. <!-- Doesn't expand paths -->

      <!-- File::Stat <=> -->
    </section>

    <!-- Times section? -->
    <!-- File.fnmatch  -->
    <section>
      <h1 id=file-stat><code>File::Stat</code></h1>

      <p><code>File::Stat</code> objects represents file metadata. They are
      normally created with <code>File#stat</code> or
      <code>File.stat(<var>file</var>)</code>. <code>File#lstat</code> and
      <code>File.lstat</code> are used to the same end, but they do not
      follow the last symbolic link, if any, in the file path; they return
      metadata for the link itself.

      <table class=border>
        <caption>Attributes of files</caption>
        <thead>  
          <tr>
            <th>Attribute
            <th>Method
            <th>Returns
            <th><a href=#kernel-test><code>Kernel.test</code></a>  
        <tbody class=zebra>        
          <tr>
            <td>Last access time
            <td><code>File::Stat#atime</code> / <code>File.atime</code> / <code>File#atime</code>
            <td><code>Time</code>
            <td><code>?A</code>  
          <tr>
            <td>Preferred block size for I/O
            <td><code>File::Stat#blksize</code>  
            <td><code>Fixnum</code> or <code>nil</code>
            <td>&nbsp;
          <tr>
            <td>Number of blocks allocated
            <td><code>File::Stat#blocks</code>  
            <td><code>Fixnum</code> or <code>nil</code>
            <td>&nbsp;
          <tr>
            <td>Inode change time
            <td><code>File::Stat#ctime</code> / <code>File.ctime</code> / <code>File#ctime</code>
            <td><code>Time</code>
            <td><code>?C</code>  
          <tr>
            <td>Device number of filesystem
            <td><code>File::Stat#dev</code>  
            <td><code>Fixnum</code> or <code>nil</code>
            <td>&nbsp;
          <tr>
            <td>〃(major part)
            <td><code>File::Stat#dev_major</code>  
            <td><code>Fixnum</code> or <code>nil</code>
            <td>&nbsp;
          <tr>
            <td>〃(minor part)
            <td><code>File::Stat#dev_minor</code>  
            <td><code>Fixnum</code> or <code>nil</code>
            <td>&nbsp;
          <tr>
            <td>Type
            <td><code>File::Stat#ftype</code>  
            <td><code>String</code>  
            <td>&nbsp;
          <tr>
            <td>Owner’s group ID
            <td><code>File::Stat#gid</code>  
            <td><code>Fixnum</code>
            <td>&nbsp;
          <tr>
            <td>Inode number
            <td><code>File::Stat#ino</code>  
            <td><code>Fixnum</code>
            <td>&nbsp;
          <tr>
            <td>Permission bits
            <td><code>File::Stat#mode</code>  
            <td><code>Fixnum</code>
            <td>&nbsp;
          <tr>
            <td>Last modify time
            <td><code>File::Stat#mtime</code> / <code>File.mtime</code> / <code>File#mtime</code>
            <td><code>Time</code>
            <td><code>?M</code>  
          <tr>
            <td>Pathname
            <td><code>File#path</code>  
            <td><code>String</code>
            <td>&nbsp;
          <tr>
            <td>Device ID
            <td><code>File::Stat#rdev</code>  
            <td><code>Fixnum</code> or <code>nil</code>
            <td>&nbsp;
          <tr>
            <td>〃(major part)
            <td><code>File::Stat#rdev_major</code>  
            <td><code>Fixnum</code> or <code>nil</code>
            <td>&nbsp;
          <tr>
            <td>〃(minor part)
            <td><code>File::Stat#rdev_minor</code>  
            <td><code>Fixnum</code> or <code>nil</code>
            <td>&nbsp;
          <tr>
            <td>Size (bytes)
            <td><code>File::Stat#size</code> / <code>File#size</code> /
              <code>File.size</code>
            <td><code>Fixnum</code> 
            <td>&nbsp;
          <tr>
            <td>Owner’s user ID
            <td><code>File::Stat#uid</code>  
            <td><code>Fixnum</code>
            <td>&nbsp;
        </table>

        <!-- Digression on bitmasks for #mode -->
    </section>

    <section>
      <h1 id=file-type>Types</h1>

      <p>We began this section by enumerating the many types of file
      objectified by <code>File</code>. To determine whether a given file is
      of a given type, one may use the appropriate predicate method of the
      <code>File</code> class. For example, <code>File.directory?</code>
      determines whether its argument is a directory. Alternatively,
      <code>File::Stat#ftype</code> returns a <code>String</code> identifying
      the type of the represented file. In the case of a directory,
      <code>#ftype</code> returns <code>directory</code>. These two approaches
      are summarised in the table that follows.

      <table class=border>
        <caption>
          <p>Types of file Ruby knows about
          <p>The <i><code>File::Stat#ftype</code></i> column contains the
          <code>String</code> that method returns for a file of the
          corresponding type. <i>Predicate</i> is a method that expects a path
          as argument, returning <code>true</code> iff the named file is of
          the corresponding type. The <i>Creation</i> column specifies, where
          possible, how a file of the corresponding type may be created in
          Ruby. Examples assume a Linux/Debian platform.
        </caption>
        <thead>
          <tr>
            <th>Description
            <th><code>File::Stat#ftype</code>
            <th>Predicate
            <th>Example  
            <th>Creation
            <th><a href=#kernel-test><code>Kernel.test</code></a>
        <tbody class=zebra>
          <tr>    
            <td>Block device
            <td><code>blockSpecial</code>
            <td><code>File.blockdev?</code>
            <td><code>/dev/sda</code>  
            <td>&nbsp;
            <td><code>?b</code>
          <tr>
            <td>Character device
            <td><code>characterSpecial</code>
            <td><code>File.chardev?</code>
            <td><code>/dev/tty</code>  
            <td>&nbsp;
            <td><code>?c</code>
          <tr>      
            <td>Directory
            <td><code>directory</code>
            <td><code>File.directory?</code>
            <td><code>/etc</code>  
            <td><code>Dir.mkdir</code>
            <td><code>?d</code>
          <tr>
            <td>FIFO (named pipe)
            <td><code>fifo</code>
            <td><code>File.pipe?</code>
            <td>&nbsp;
            <td><code>system("mkfifo <var>name</var>")</code>
            <td><code>?p</code>
          <tr>
            <td>Regular file
            <td><code>file</code>
            <td><code>File.file?</code>
            <td><code>/etc/passwd</code>  
            <td><code>Kernel.open</code>
            <td><code>?f</code>
          <tr>
            <td>Symbolic link
            <td><code>link</code>
            <td><code>File.symlink?</code>
            <td><code>/dev/root</code>  
            <td><code>File.symlink</code>
            <td><code>?l</code>
          <tr>
            <td>Socket
            <td><code>socket</code>
            <td><code>File.socket?</code>
            <td><code>/dev/log</code>  
            <td>Use the <code>socket</code> library 
            <td><code>?S</code>
          <tr>
            <td>Another type of file  
            <td><code>unknown</code>
            <td>&nbsp;
            <td>&nbsp;
            <td>&nbsp;
            <td>&nbsp;
      </table>
    </section>  

    <section>
      <h1 id=file-permissions>Permissions</h1>

      <p>The permission bits associated with a file may be retrieved from
      the corresponding <code>File::Stat</code> object. The fields of
      interest are described below. Be aware that on non-<abbr
        title='Portable Operating System Interface [for Unix]'>POSIX</abbr>
      systems the semantics of file permissions are quite different,
      and are likely to be less granular. To compensate, on these
      disadvantaged platforms Ruby attempts to synthesize a numeric mode
      such that it is broadly similar to what POSIX requires. However, given
      the lack of granularity and other incompatibilities, these factitious
      modes are cumbersome and error-prone. It is therefore recommended
      that the permission bits are treated as opaque, as far as possible,
      and the predicates described later are used instead.
      
      <table class=border>
        <caption>
          Permission and ownership attributes of <code>File::Stat</code>
          objects
        </caption>
        <thead>  
          <tr>
            <th>Attribute
            <th>Method
            <th>Returns
        <tbody class=zebra>        
          <tr>
            <td>Owner’s group ID
            <td><code>File::Stat#gid</code>  
            <td><code>Fixnum</code>
          <tr>
            <td>Permission bits
            <td><code>File::Stat#mode</code>  
            <td><code>Fixnum</code>
          <tr>
            <td>Owner’s user ID
            <td><code>File::Stat#uid</code>  
            <td><code>Fixnum</code>
      </table>

      <p>The permissions of a file may be changed with
      <code>File.chmod</code> by providing the new permission bits as the
      first argument, and a list of files as the subsequent arguments. Each
      file listed has its permissions changed accordingly. The meaning of
      the permission bits is platform-specific, but on Unix-like systems
      they correspond to the numeric mode understood by
      <code>chmod(1)</code>. Some systems, such as the <abbr title='Berkeley
        Software Distribution'>BSD</abbr>s, support a variant of
      <code>chmod</code> that does not follow symbolic links, therefore acts
      upon the link rather than its target. If available, Ruby exposes this
      functionality via <code>File.lchmod</code>, which takes the same
      arguments as <code>File.chmod</code>. <code>File</code> also provides
      the instance methods <code>File#chmod</code> and
      <code>File#lchmod</code>, which require the permission bits to assign
      to their receiver as their sole argument.

      <p>The owner and group of a file may be changed-although the former
      requires root permissions-with <code>File.chown</code>. It takes a
      numeric user ID, and numeric group ID, as the first and second
      arguments, respectively, and a list of files as the subsequent
      arguments. The ownership of each file listed that the user has
      permission to change is adjusted accordingly. <code>File.lchown</code>
      functions similarly, but does not follow symlinks. Its availability
      mirrors that of <code>File.lchmod</code>. The instance method,
      <code>File#chown</code>, requires a numeric user ID, and numeric group
      ID, as its arguments, which it applies to its receiver.

      <p>The umask value of the current process is set by supplying
      <code>File.umask</code> with the new value as an <code>Integer</code>
      argument. It returns the previous umask value. When called without
      arguments, <code>File.umask</code> returns the current umask.

      <!-- Note that permission bits are normalised -->
      <table class=border>
        <caption>
          <p>Permissions predicate methods of the <code>File</code> class.
          <p>Methods take a filename as argument and return either
          <code>true</code> or <code>false</code> unless stated otherwise. The
          <i><code>Kernel.test</code></i> column indicates the corresponding
          command for use with <code>test</code>.
        </caption>
        <thead>  
          <tr>
            <th>Predicate
            <th>Test 
            <th><a href=#kernel-test><code>Kernel.test</code></a> 
        <tbody class=zebra>        
          <tr>
            <td><code>File.executable?</code>
            <td>Executable by our effective user ID?  
            <td><code>?x</code>  
          <tr>
            <td><code>File.executable_real?</code>
            <td>Executable by our real user ID?  
            <td><code>?X</code>  
          <tr>
            <td><code>File.grpowned?</code>
            <td>Owned by our effective group ID?  
            <td><code>?G</code>  
          <tr>
            <td><code>File.owned?</code>
            <td>Owned by our effective user ID?  
            <td><code>?o</code>  
          <tr>
            <td><code>File.readable?</code>
            <td>Readable by our effective user ID?  
            <td><code>?r</code>  
          <tr>
            <td><code>File.readable_real?</code>
            <td>Readable by our real user ID?  
            <td><code>?R</code>  
          <tr>
            <td><code>File.setgid?</code>
            <td><abbr title='Set group ID upon execution'>Setgid</abbr> bit set?  
            <td><code>?g</code>  
          <tr>
            <td><code>File.setuid?</code>
            <td><abbr title='Set user ID upon execution'>Setuid</abbr> bit set?  
            <td><code>?u</code>  
          <tr>
            <td><code>File.sticky?</code>
            <td>Sticky bit set?  
            <td><code>?k</code>  
          <tr>
            <td><code>File.world_readable?</code>
            <td>Readable by others? (Returns permission bits or
              <code>nil</code>)  
            <td>&nbsp;
          <tr>
            <td><code>File.world_writable?</code>
            <td>Writable by others? (Returns permission bits or <code>nil</code>)
            <td>&nbsp;
          <tr>
            <td><code>File.writable?</code>
            <td>Writable by our effective user ID?  
            <td><code>?w</code>  
          <tr>
            <td><code>File.writable_real?</code>
            <td>Writable by our real user ID?  
            <td><code>?W</code>  
        </table>
    </section>

    <section>
      <h1 id=symlinks>Symbolic Links</h1>
      
      <!-- Rename to Links; mention File.link -->
      <p>On platforms that support symlinks, <code>File.symlink</code> will
      create a link to the file named as its first argument, with the name
      given as its second. The <code>File.symlink?</code> predicate can be
      used to test whether its argument is a symlink, and
      <code>File.readlink</code> returns the target of a given link.</p>

      <figure id=file-symlink.rb>
        <figcaption>A symbolic link can be created with
        <code>File.symlink</code>
      </figure>
    </section>

    <section>
      <h1 id=kernel-test><code>Kernel.test</code></h1>

      <p><code>Kernel.test</code> performs a given test on a given file. It
      accepts 2&ndash;3 arguments, the first of which is a single character
      command, and the remainder are the files on which to perform the test. 

      <table class=border>
        <caption>Commands supported by <code>Kernel.test</code></caption>
        <thead>
          <tr>
            <th>Command
            <th>Description
            <th>Returns
            <th>Arity
        <tbody class=zebra>        
          <tr>
            <td><code>?A</code>
            <td>Last access time  
            <td><code>Time</code>  
            <td>1
          <tr>
            <td><code>?b</code>
            <td>Block device?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?c</code>
            <td>Character device?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?C</code>
            <td>Last status change time  
            <td><code>Time</code>  
            <td>1
          <tr>
            <td><code>?d</code>
            <td>Directory?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?e</code>
            <td>Exists?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?f</code>
            <td>Exists and a regular file?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?g</code>
            <td>Has the <code>setgid</code> bit set?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?G</code>
            <td>Exists and owned by our group?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?k</code>
            <td>Sticky bit set?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?l</code>
            <td>Exists and a symlink?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?M</code>
            <td>Last modification time  
            <td><code>Time</code>
            <td>1
          <tr>
            <td><code>?o</code>
            <td>Owned by our effective user ID?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?O</code>
            <td>Owned by our real user ID?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?O</code>
            <td>Owned by our real user ID?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?p</code>
            <td>A FIFO?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?r</code>
            <td>Readable by our effective user/group ID?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?R</code>
            <td>Readable by our real user/group ID?  
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?s</code>
            <td>Returns the size if non-zero 
            <td><code>Integer</code> or <code>nil</code>
            <td>1
          <tr>
            <td><code>?S</code>
            <td>Socket? 
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?u</code>
            <td><code>setuid</code> bit set? 
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?w</code>
            <td>Exists and writable by our effective user/group ID? 
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?W</code>
            <td>Exists and writable by our real user/group ID? 
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?x</code>
            <td>Exists and executable by our effective user/group ID? 
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?X</code>
            <td>Exists and executable by our real user/group ID? 
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?z</code>
            <td>Exists with a size of zero? 
            <td><code>true</code> or <code>false</code>
            <td>1
          <tr>
            <td><code>?-</code>
            <td>Are both operands identical? 
            <td><code>true</code> or <code>false</code>
            <td>2
          <tr>
            <td><code>?=</code>
            <td>Do both operands have the same modification time? 
            <td><code>true</code> or <code>false</code>
            <td>2
          <tr>
            <td><code>?&lt;</code>
            <td>Is the modification time of the first operand prior to that of
              the second? 
            <td><code>true</code> or <code>false</code>
            <td>2
          <tr>
            <td><code>?&gt;</code>
            <td>Is the modification time of the first operand after that of
              the second? 
            <td><code>true</code> or <code>false</code>
            <td>2
      </table>
    </section>
  </section>
</article>
