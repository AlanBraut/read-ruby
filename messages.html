<!DOCTYPE html>
<!-- vim: set fdm=indent tw=78: --> 
<html>
  <head>
    <title>Messages - Read Ruby</title>
    <meta charset=utf-8>
    <!-- <script src="http://html5-now.appspot.com/base2-legacy.js"></script> 
    <script src="http://html5-now.appspot.com/html5-now.js"></script>
    -->
    <link href=/style rel=stylesheet>
    <link rel=license href=//creativecommons.org/licenses/by-nc-sa/2.0/uk/>
    <link rel=next href=/methods>
  </head>
  <body>

  <section>    
    <h1 id=messages>Messages</h1>

      <!-- List messages objects _should_ respond to, and those messages that are
      useful to define methods for -->
      
      <section>
        <!-- Enclose in <header> ? -->
        <blockquote cite=#refKAY98>  
          <p>…Smalltalk is not only NOT its syntax or the class library, it is not
          even about classes. I'm sorry that I long ago coined the term “objects”
          for this topic because it gets many people to focus on the lesser idea.

          <p>The big idea is “messaging” -- that is what the kernal[<i>sic</i>] of
          Smalltalk/Squeak is all about (and it’s something that was never quite
          completed in our Xerox PARC phase). The Japanese have a small
          word—<i>ma</i>—for “that which is in between”—perhaps the nearest English
          equivalent is “interstitial”. The key in making great and growable systems
          is much more to design how its modules communicate rather than what their
          internal properties and behaviors should be. 
          <cite><a href=/references#refKAY98 class=ref>Dr Alan Kay</a>, 1998</cite>
        </blockquote>

        <p>A message is a <q>request for an object to perform some
        operation</q> (<a href=/references#refBUDD87 class=ref>Budd</a>, p.
        6). It consists of <q>a <i>receiver</i>, a message <i>selector</i>,
        and zero or more <i>arguments</i>.</q> (<a href=/references#refBUDD87
        class=ref>Budd</a>, p. 16).</p>
        
        <!-- Diagram a message send -->
        <aside>
          <p><a href=/references#refLIU99 class=ref>Liu</a> (p. 2) suggests
          that it can be helpful to envisage messages as telegrams:</p>
          
          <blockquote cite=/references#refLIU99>
            <p>“Message” is too abstract a word. A better word is
            <i>telegram</i>. A “telegram” is tangible: I can touch it, I can
            see the information it carries, and I can picture the moment it
            arrives at the door of its addressee. It is not some vague
            electronic-sounding thing like a “message”. Therefore, I encourage
            you to think of an old-fashioned telegram whenever you see the
            term “message”.  <cite><a class=ref href=/references#refLIU99>C.
            Liu</a>, 1999</cite> 
          </blockquote>
        </aside>
      </section>

      <section>
        <h1 id=purpose>Purpose</h1>

        <p>A message is <i>sent</i> to a receiver for the value it will
        return, and/or the side effects, if any, that result. 
        
        <p>A message expression always returns a value. It may also result in
        side effects: alteration of the receiver’s state. For instance,
        <code>3.odd?</code> has a return value of <code>true</code>, but no
        side effects; <code>Array#&lt;&lt;</code> appends its argument to the
        receiver (the side effect), which it returns (the return value). 

        <p>If a message is sent purely for the side effects, its return value
        can be ignored by not using in further computations. If the side
        effects are undesirable, the message should not be sent; they are its
        inevitable consequence.

        <p>A message that does not have any side effects is <dfn
          title="idempotent message">idempotent</dfn>. For example,
        <code>Array#size</code> does not have any side effects; it is sent
        solely for the value it returns (the receiver’s size). 

        <!-- "sub-category"? -->
        <p>A sub-category of messages being sent for their side effects are
        those sent to notify an object of an event, where the sender has no
        interest in the return value or whether the receiver even responds to
        the message. The sender is obligated only to notify the recipient; it
        is the responsibility of the recipient to handle the notification.  <a
          href=#object-send-p><code>Object#send?</code></a>, or the
        accompanying manual approach, may be used in this case.</p>

        <!-- Cascades -->
      </section>

      <section>
        <h1 id=distinction>The Distinction Between Messages and Methods</h1>

        <p>A message selector often corresponds to the name of a method in the
        receiver. That is, sending the message <var>s</var> to receiver
        <var>r</var> is equivalent to invoking the method <var>s</var> on
        <var>r</var>. Indeed, <a href=/references#refFLAN08 class=ref>Flanagan
        &amp; Matsumoto</a> (p. 178) claim that <q>…methods are called
        ‟messages”</q>.

        <p>In the definitions of <a href=/references#refBUDD87
        class=ref>Budd</a> (p. 6), <a href=/references#refHUNT97
        class=ref>Hunt</a> (p. 73), <a href=/references#refMITCHELL04
        class=ref>Mitchell</a> (p. 279), and <a href=/references#refKLAS95
        class=ref>Klas &amp; Schrefl</a> (p. 13), <i>message</i> refers to the
        <i>request</i> being made of an object; whereas <a
        href=/references#refFLAN08 class=ref>Flanagan &amp; Matsumoto</a> use
        it to refer the means with which the receiver would respond to such a
        request. We prefer what Mitchell terms <q>Smalltalk terminology</q>
        because it is well established in the literature, and the basis for
        Ruby’s misappropriation.

        <p>Further, there is not necessarily a one-to-one correspondence
        between message selector and method name. If the named method does not
        exist, the receiver may respond by sending itself a
        <code>:method_missing</code> message, which would contradict this
        simplistic assertion, but still fulfil the request the message
        represented.

        <p>The proper relation of <i>message</i> to <i>method</i> can be
        understood by <a class=ref href=/references#refBUDD87>Budd</a>’s use
        of the term <i>operation</i>: a method must perform the requested
        operation, invoking whatever method is most appropriate to do so.

        <!-- Expand on this idea: shared vocabulary? -->
        <p>Defining messages in terms of operations also provides the framework for
        our later discussion of <a href=#type><i>duck typing</i></a>.
      </section>

      <section>
        <h1 id=selectors>Selectors</h1>

        <!-- TODO: Talk here about "significant names"? Decide what material moves
        from the Method > Names section to here -->

        <p>The message <dfn title="message selector">selector</dfn> is the
        name of the operation the receiver should perform in response to
        message.</p>

        <aside class=note>
          Subsequently we will refer to a specific selector with the <a
          href=#symbols><code>Symbol</code> literal syntax</a>, i.e.
          <code>:<var>selector</var></code>: the selector name prefixed with a
          colon. This is consistent with Ruby’s general use of
          <code>Symbol</code>s, and distinguishes a selector from a bare
          identifier.
        </aside>

        <p>The selector is assumed to be the name of a method defined upon the
        receiver or one of its superclasses. If a corresponding method is not
        found in the receiver, the <a href=#method-missing>Method Missing</a>
        protocol is initiated.</p>

        <aside>
          <p>A message selector may consist of any <code>Symbol</code>, even
          those which are illegal when defining a method with the
          <code>def</code> keyword. Methods with corresponding names can be
          defined with <code>Object#define_method</code>, or such messages can
          be handled by <a
          href=#method-missing><code>:method_missing</code></a>.
        </aside>
      </section>

      <section>
        <h1 id=receivers>Receivers</h1>

        <p>Every message is sent to a <dfn title="message
        receiver">receiver</dfn> object, which may be explicit or
        implicit.</p>

        <section>
          <h1 id=implicit-receiver>Implicit Receivers</h1>

          <p>If a receiver is not specified an <dfn>implicit receiver</dfn> of
          <code>self</code> is assumed. <code>self</code> always refers to the
          current object. Outside of any class definition, i.e. at the
          top-level, the current object is an instance of <code>Object</code>
          called <code>main</code>. Inside a class definition, but outside of
          a method definition, the current object is an instance of
          <code>Class</code>. Within a method definition the current object is
          the instance of the containing class.</p>

          <figure id=self-as-the-implicit-receiver>
            <figcaption><code>self</code> is always defined; its value depends
            on the enclosing context.
          </figure>

          <p>There are four situations where the implicit receiver can not be
          used:

          <ol>
            <li>The selector is also a keyword such as <code>class</code>. (An
            implicit receiver would create syntactical ambiguity).
            <li>The selector is that of a non-unary <a
            href=#operator-methods>operator method</a>. 
            <li>The selector is used as an <a
              href=#ambiguous-lvalue-syntax>lvalue</a>.
            <li>The message name is identical to a local variable. (This case can
            also be disambiguated by immediately following the selector with a
            pair of parentheses, i.e. <code><var>selector</var>()</code>).
          </ol>

          <p>By contrast, the implicit receiver must be used when the message is
          private.</p> <!-- Are _messages_ private? -->
          
          <figure id=implicit-receiver-for-private-method>
            <figcaption>Private messages must be sent with an implicit
            receiver.
          </figure>

           <!-- TODO: Explain how 'puts "glark"' works in this context? -->
        </section>

        <section>
          <h1 id=explicit-receiver>Explicit Receivers</h1>

          <p>An explicit receiver is an arbitrary expression whose value
          receives the message. It cannot be used when the message is private.

          <p>The expression is typically an identifier. For example,
          <code>house.build(floors: 2, style: :victorian)</code> sends the
          message with the selector <code>:build</code> to the object
          <code>house</code>.  If the expression is itself a message
          expression, we say the messages are <a
          href=#message-chaining>chained</a>.

          <p>However, the receiver may be any expression, parenthesised if
          necessary to force precedence. For example, <code>(10 **
            10).to_s</code> evaluates the parenthetical, then sends its value
          (<code>100</code>) the <code>:to_s</code> message.
        </section>
      </section>

      <!-- Arguments section? -->

      <section>
        <h1 id=expression-syntax>Message Expression Syntax</h1>

        <!-- We're using _message expression_ to describe this syntax... (dfn it?) -->

        <p>The simplest <dfn title="message expression">expression for sending
        a message</dfn> is <code><var>s</var></code>, where <var>s</var> is
        the message selector.  Omitting the name of the receiver to which
        <var>s</var> should be sent causes the <a
        href=#implicit-receiver>implicit receiver</a> to be assumed.</p>

        <aside class=note>
          The syntax explained above is potentially ambiguous. If Ruby sees a
          bare identifier, e.g. <code>glark</code>, is that a reference to a
          local variable or an attempt to send a message to <code>self</code>?
          If Ruby has previously seen the identifier being assigned to, e.g.
          <code>glark = 2</code>, it is treated as a variable reference;
          otherwise it is a message.
        </aside>

        <figure id=bare-selector-syntax>
          <figcaption>A bare identifier is interpreted as a message selector
          unless it has previously been used as a local variable name in the
          same scope.
        </figure>

        <p>The receiver can be specified explicitly with the
        <code><var>receiver</var>.<var>selector</var></code> syntax, where
        <var>receiver</var> is an <a href=#explicit-receiver>explicit
        receiver</a> separated from the
        <var>selector</var> with a full stop (U+002E: <code>.</code>).</p>

        <figure id=receiver-dot-selector-syntax>
          <figcaption>A message can be explicitly sent to an object by
          concatenating an explicit receiver, a full stop, and a selector.
        </figure>

        <aside class=note>
          An alternative to the
          <code><var>receiver</var>.<var>selector</var></code> syntax is
          <code><var>receiver</var>::<var>selector</var></code>, where the
          full stop is replaced with a double colon (U+003A: <code>::</code>).
          However, the latter syntax has fallen out of favour due to the
          confusion it creates between message sending and constant reference
          expressions.  It is not recommended for use in new code.
        </aside>

        <p>In either case, a <code>NoMethodError</code> is raised if the
        receiver neither defines a corresponding method nor defines a
        <code>method_missing</code> method that handles the message.</p>

        <section>
          <h1 id=message-arguments>Arguments</h1>
          
          <p>A message may be accompanied by one or more <dfn title="message
          arguments">arguments</var>: variables to be used in the resulting
          computations. Arguments are supplied as a parenthesized list of
          variables separated by commas:
          <code><var>receiver</var>.<var>selector</var>(<var>arg<sub>0</sub></var>,…,<var>arg</var><sub>n</sub>)</code>.</p>
          
          <figure id=receiver-selector-arguments-syntax>
            <figcaption>The selector may be followed by a parenthesised list
            of zero or more arguments.
          </figure>

          <p>If a message is sent with an unexpected number of arguments an
          <code>ArgumentError</code> is raised.</p>

          <aside class=note> 
            <p>It is often the case that a message needs to be sent with
            multiple arguments, yet those arguments are stored in an
            <code>Enumerable</code> such as <code>Array</code>. If the message
            is sent with just the <code>Enumerable</code> argument it will
            receive a single argument (a reference to the
            <code>Enumerable</code>) rather than the constituent elements
            thereof. The solution is to prefix the <code>Enumerable</code>
            argument with an asterisk (U+002A: <code>*</code>), which in this
            context is termed a <dfn>splat operator</dfn>, thus expanding the
            <code>Enumerable</code> into its individual elements.</p>

            <figure id=splat-arguments>
              <figcaption>Prefixing an <code>Enumerable</code> argument with
              an asterisk explodes it into its constituent elements.
            </figure>

            <p>This technique works by sending <code>:to_a</code> to the
            prefixed object, so any object that responds to this message with
            an <code>Array</code> can be used in the same fashion.  
          </aside>

          <section>
            <h1 id=block-argument>Block Literals</h1>

              <p>A message expression followed by a block literal causes the
              block to be sent along with the message. A block literal may be
              enclosed in curly braces (<code>{</code>…<code>}</code>) or a
              <code>do</code>…<code>end</code> construct. These forms are
              semantically equivalent, however it is conventional to use the
              former for short blocks that fit on a single line, and the
              latter for multi-line blocks.</p>

              <figure id=message-expression-with-block>
                <figcaption>A message expression followed by a block literal
                causes the block to be passed to the method.
              </figure>

              <!-- Suggest here that Enumerators are returned when no block is given?
              -->

              <aside class=note>
                <p>To send a <code>Proc</code> object along with a message
                expecting an anonymous block, prefix the object name with an
                ampersand (U+0026: <code>&amp;</code>). If multiple arguments
                are given the <code>Proc</code> must be specified last.</p>

                <figure id=ampersand-prefix-with-argument>
                  <figcaption>Prefix the final argument with an ampersand to
                  convert it to a block literal.
                </figure>

                <p>This technique works by sending <code>:to_proc</code> to
                the object, and using the <code>Proc</code> returned as the
                block. By extension, any object that responds to
                <code>:to_proc</code> in this manner can be used in the same
                fashion.
                <!-- Point to Symbol#to_proc here? --> 
              </aside>
            <!-- Enumerable objects return an Enumerator when sent a message
                 that expects a corresponding block without said block. What's
                 the general principle?
            -->
          </section>

          <section>
            <h1 id=parentheses>Parentheses</h1>

              <p>Parentheses may be omitted from message expressions when
              doing so does not introduce syntactic ambiguity.

              <p>They are rarely used in message expressions that don't
              involve arguments. For example, <code>'briefcase'.upcase</code>
              is equivalent to <code>'briefcase'.upcase()</code>; the former
              is the recommended style. 

              <p>However, they do disambiguate a selector from a local
              variable when the message has an implicit receiver and both
              variable and selector share the same name.</p>

              <figure id=parentheses-disambiguate-bare-identifiers>
                <figcaption>Parentheses are required to disambiguate an
                implicitly-received message’s selector from a local variable
                with the same name.
              </figure>

              <p>Parentheses may usually be omitted even when arguments are
              involved. If so, there must be whitespace between the selector
              name and the first argument.</p>

              <figure id=parentheses-omitted-in-message-expressions>              
                <figcaption>Parentheses can often be omitted from message
                expressions involving arguments.
              </figure>

              <p>A common case when parentheses are <i>required</i> to disambiguate is
              nested message expressions where multiple arguments are involved, such as
              <code><var>a</var> <var>b</var> <var>c</var>, <var>d</var></code>, where
              <var>a</var> and <var>b</var> are selectors. To whom do the arguments,
              <var>c</var> and <var>d</var> belong? Does the programmer mean
              <code><var>a</var>(<var>b</var>(<var>c</var>, <var>d</var>))</code> or
              <code><var>a</var>(<var>b</var>(<var>c</var>), <var>d</var>)</code>? Ruby
              assumes the former. However, even if the programmer agrees with Ruby's
              interpretation, these forms of expression are seldom as clear to others.
              Therefore, it is recommended to employ parentheses in such cases, even if
              unnecessary, as an aid to legibility.</p>

              <figure id=message-expressions-omit-parentheses-syntaxerror>
                <figcaption>It is illegal to omit parentheses in nested
                message expressions when doing so introduces ambiguity.
              </figure>

              <p>When parentheses are used to enclose a message’s arguments,
              the opening parenthesis must immediately follow the selector
              like so:
              <code><var>selector</var>(<var>arg<sub>0</sub></var>,…,<var>arg<sub>n</sub></var>)</code>.
              Whitespace between <var>selector</var> and <code>(</code> will
              result in a <code>SyntaxError</code>. This is due to a quirk in
              Ruby’s syntax inasmuch as parentheses serve two distinct
              functions—grouping of expressions and associating an argument
              list with a message expression—so the above form represents an
              ambiguity.</p>
          </section>

          <figure class=railroad>
            <img id=expression-list>
            <img id=argument-list>
            <img id=message-expression>
            <figcaption>Syntax diagram for message expression
          </figure>
        </section>
        
        <section>
          <h1 id=message-chaining>Chaining</h1>

          <p>A message expression returns an object, which may in turn receive
          messages, i.e.
          <code><var>receiver</var>.<var>selector<sub>0</sub></var>.<var>selector<sub>1</sub></var></code>.
          <var>receiver</var> is sent <var>selector<sub>0</sub></var> which
          returns an object; that object is sent
          <var>selector<sub>1</sub></var>. Message expressions can be
          arbitrarily <dfn title="message chaining">chained</dfn> in this
          fashion.</p>

          <figure id=message-chaining>
            <figcaption>The receiver of a message may itself be a message
            expression, allowing messages to be chained.
          </figure>

          <p>This technique relies on the composite receiver consistently
          returning an object responding to the selector; otherwise a
          <code>NoMethodError</code> will break the chain. It is unsuitable
          when the receiver may return a materially different object for
          certain arguments. For instance, <code>Array#select</code> <!--
          Footnote that this method is provided by Enumerable but we haven't
          introduced modules yet? --> always returns an <code>Array</code>
          even when it doesn’t select any elements, allowing it to receive any
          <code>Array</code> selector. Conversely, methods such as
          <code>Array#[]</code>, which return either the specified element or
          <code>nil</code> if it does not exist, make awkward links in chains
          because of their inconsistency.</p>

          <figure id=message-chaining-inconsistent-return-value>
            <figcaption>Messages cannot be usefully chained if they have
            inconsistent return values.
          </figure>

          <!-- Mention andand -->

          <p>Messages sent purely for their side effects should, and often do,
          return <code>self</code> so as to receive any message understood by
          their receiver. </p>

          <figure id=message-chaining-return-self>
            <figcaption>Message chaining relies on each link consistently
            returning an object of the same type.
          </figure>
        </section> 
          
        <section>
          <!-- Better phrase than "dynamic sending"? -->
          <h1 id=object-send>Dynamic Sending with <code>Object#send</code></h1>
      
          <p>A message can also be sent to an object with
          <code>Object#send</code>, i.e.
          <code><var>receiver</var>.send(<var>selector</var>,
          <var>arg<sub>0</sub></var>,…,<var>arg<sub>n</sub></var>)</code>.
          This allows the message selector to be determined dynamically, at
          runtime, as opposed to the syntax described previously which
          requires the selector to be a literal, embedded in the source.</p>

          <figure id=object-send>
            <figcaption><code>Object#send</code> sends an object a message
            whose name can be determined at runtime.
          </figure>

          <p><code>Object#send</code> is aliased to <code>__send__</code>, so
          even if the former is overidden, the alias can be used in its place.
          A warning is issued if the user overrides <code>__send__</code>.

          <p><code>Object#public_send</code> performs the same function, but
          raises a <code>NoMethodError</code> if the method is private or
          protected.
        </section>
      </section>

      <section>
        <h1 id=attributes>Attribute Accessors and Setters</h1>

        <!-- TODO: Note use of term 'unary' message --> 
        <p>A message without arguments that returns the value of the corresponding
        instance variable, or <dfn>attribute</dfn>, in the receiver is
        sometimes referred to as an <dfn>attribute
          accessor</dfn>. For example, <code>person.name</code> is said to return
        the <code>name</code> attribute of the <code>person</code> object.

          <!-- TODO: Link with discussion of _attr_ in Objects -->

        <p>There is not necessarily a correspondence between the accessor’s name
        and that of the corresponding instance variable. There is not, for that
        matter, necessarily a corresponding instance variable at all: the
        attribute value might have been computed dynamically, for example. 

        <p>A message with an argument whose selector comprises an attribute
        accessor’s name suffixed with an equals sign (<code>=</code>), is
        called an <dfn>attribute setter</dfn>. It sets the attribute to the
        value supplied. A message with a selector
        <code><var>selector</var>=</code> can be used as an lvalue, i.e.
        <code><var>receiver</var>.<var>selector</var> =
        <var>value</var></code> is equivalent to
        <code><var>receiver</var>.<var>selector</var>=(<var>value</var>).</code></p>

        <aside id=ambiguous-lvalue-syntax class=warning>
          <p>The syntax <code>name = value</code> is therefore ambiguous. Is
          the intent to assign the value <code>value</code> to the local
          variable <code>name</code> or to send the message <code>name=</code>
          with <code>value</code> as the argument?

          <p>The resolution is to either send the message with an explicit
          receiver, or make it explicit that you are sending a message with
          the <code><var>selector</var>=(<var>value</var>)</code> syntax.  
        </aside>
      </section>

      <section>
        <h1 id=conventions>Conventions</h1>

        <p>Around certain selectors there exist conventions which are
        established by the core classes and standard library, so are worthy of
        emulation. When using classes written by others, familiarity with
        these conventions affords the user a head start in his understanding.
        These are, however, merely suggestions—explanations of traditions; not
        a list of requirements. Ignore as you see fit.</p>

        <section>
          <!--<h1>Common Selectors</h1>-->

          <dl>
            <dt><code>:call</code>
            <dd>
            
              <p>A variable-length argument list is accepted, with which the
              receiver is in some way invoked. The return value is the result
              of the invocation. <code>Method</code> and <code>Proc</code>
              objects both behave in this fashion.

              <p>This selector is notable because it instruments the following
              syntax:
              <code><var>receiver</var>.call(<var>arg</var><sub>0</sub>…<var>arg</var><sub>n</sub>)</code>
              is equivalent to
              <code><var>receiver</var>.(<var>arg</var><sub>0</sub>…<var>arg</var><sub>n</sub>)</code>.
              That is, the selector’s name can be omitted from the message
              expression.</p>
              
              <figure id=call-selector>
                <figcaption>Omitting the selector name in a message expression
                causes <code>:call</code> to be assumed.
              </figure>

            <dt><code>:each</code> / <code>:each_</code>*
            <dd>
            <!-- We're duplicating the description of #each and Enumerable with
            the _enumerables_ section... -->
              <p>Classes mixing-in the <a
                href=#enumerables><code>Enumerable</code></a> module are expected,
              by default, to respond to <code>:each</code> by yielding the next
              element of the sequence. Conventionally, it returns an
              <code>Enumerator</code> when the block is omitted. 

              <figure id=each-selector>
                <figcaption>The <code>:each</code> selector yields each
                element of the receiver if given a block; otherwise returns an
                <code>Enumerator</code>.
              </figure>

              <p>Messages with selectors of the form
              <code>:each_<var>attribute</var></code> request their receiver
              enumerates the collection in terms of <var>attribute</var>, that is
              yielding each successive <var>attribute</var>; as opposed to <code>:each</code>
              which presumably yields a different sort of attribute. For example,
              <code>String#each_codepoint</code> interprets the string as a
              collection of codepoints, yielding each in turn.
              <code>String#each_char</code>, however, interprets the string as a
              collection of characters, so will yield a different sequence of
              objects. An object need only respond to such messages if it already
              responds to <code>:each</code>, and can sensibly be enumerated in
              another fashion. It is common to provide an alias for a selector of
              this form named with the plural of <var>attribute</var>, e.g.
              <code>String#each_byte</code> is aliased to
              <code>String#bytes</code>; <code>IO#each_line</code> is aliased to
              <code>IO#lines</code>. <!-- Enumerable doesn't provide this alias.
              Bug? -->

              <figure id=each_-selector>
                <figcaption>Selectors named
                <code>:each_<var>attribute</var></code> enumerate the receiver
                by <var>attribute</var>.
              </figure>

            </dd>
            <dt><code>:size</code> / <code>:length</code>
            <dd><code>:size</code> and <code>:length</code>, which are typically
            aliases of each other, return an <code>Integer</code> representing the
            magnitude of the receiver. For example, <code>Array#size</code>
            returns the number of elements the receiver contains;
            <code>File#size</code> returns the receiver’s size in bytes.

            <figure id=size-selector>
              <figcaption>The <code>:size</code> selector returns the
              receiver’s magnitude as an <code>Integer</code>.
            </figure>

            <dt><code>:</code>*<code>_by</code>
            <dd>The <code>_by</code> suffix typically implies that the method
            expects a block, the results of which constrain the computation. For
            example, <code>Enumerable#group_by</code>,
            <code>Enumerable#sort_by</code>, and
            <code>Enumerable#minmax_by</code>.
            
            <figure id=_by-selector>
              <figcaption>Selectors with a <code>_by</code> suffix accept a
              block which constrains their computation.
            </figure>

            <dt><code>:to_</code>*
            <dd><a href=#conversion>Converts</a> the receiver into an object of
            the corresponding core type.

            <figure id=to_-selector>            
              <figcaption>Selectors with a <code>to_</code> prefix return the
              receiver as an object of the given type.
            </figure>

            <dt><code>:try_convert</code>
            <dd>Class method which <a href=#try-convert>implicitly converts</a>
            the argument to the receiver.

            <figure id=try_convert-selector>
              <figcaption>The <code>:try_convert</code> selector implicitly
              converts it argument to its receiver, returning <code>nil</code>
              if unsuccessful.
            </figure>

            <dt><code>:&lt;=&gt;</code>
            <dd><a href=#comparison>Compares</a> the operands.

            <figure id=spaceship-selector> 
              <figcaption><code>&lt;=&gt;</code> compares its receiver to
              argument.
            </figure>
            
            <dt><code>:&lt;</code>
            <dd>Determines whether the receiver is <i>less than</i> the argument.
            Normally implemented in terms of <a
              href=#comparison><code>&lt;=&gt;</code></a>. <code>Class#&lt;</code>
            creatively uses this selector to test whether the receiver is a
            <i>kind of</i> the argument because it mirrors the syntax for defining
            a class with a superclass, i.e. <code>class <var>name</var> &lt;
              <var>superclass</var>…end</code>.

            <figure id=less-than-selector>
              <figcaption>The <code>:&lt;</code> selector returns
              <code>true</code> if the receiver is less than the argument;
              <code>false</code> otherwise.
            </figure>

            <dt><code>:&gt;</code>
            <dd>Determines whether the receiver is <i>greater than</i> the argument.
            Normally implemented in terms of <a
              href=#comparison><code>&lt;=&gt;</code></a>. <code>Class#&gt;</code>
            provides symmetry to <code>Class#&lt;</code> by testing whether the
            argument is a <i>kind of</i> the receiver.

            <figure id=greater-than-selector>
              <figcaption>The <code>:&gt;</code> selector returns
              <code>true</code> if the receiver is greater than the argument;
              <code>false</code> otherwise.
            </figure>
            
            <dt><code>:==</code>
            <dd>Determines whether the operands are <a
              href=#equivalence>equivalent</a>.
            
            <figure id=equal-equal-selector>
              <figcaption>The <code>:==</code> selector returns
              <code>true</code> if its operands are logically equivalent;
              <code>false</code> otherwise.
            </figure>

            <dt><code>:[]</code>
            <dd>
              <!-- Needs to follow message expression syntax -->
              <p><dfn title="element reference">Element reference</dfn> syntax:
              indexes the receiver by the “key” supplied as the argument(s),
              returning the requested slice or <code>nil</code>/<code>[]</code> if
              no corresponding data was found. It is a special case of the message
              expression syntax because it sends a selector named <code>:[]</code>
              to the receiver, passing in the contents of
              <code>[</code>…<code>]</code> as arguments, i.e.
              <code><var>receiver</var>[<var>argument<sub>0</sub></var>,…,<var>argument<sub>n</sub></var>]</code>
              is equivalent to
              <code><var>receiver</var>.[](<var>argument<sub>0</sub></var>,…,<var>argument<sub>n</sub></var>)</code>

              <p>The simplest example is <code>Array#[]</code>, which returns the
              element stored at the given <code>Integer</code> index. Similarly,
              <code>Hash#[]</code> returns the value corresponding to the given
              key object. In this role, <code>:[]</code> acts as an interface to a
              pre-computed lookup table.
              
              <p>However, this abstraction conveniently extends to virtual slices,
              where the values are computed dynamically, shielding the user from
              these unnecessary details: he need not concern himself with
              <i>how</i> the data are derived, merely that they satisfy the key.
              For example, <code>Array#[]</code> also accepts a <code>Range</code>
              argument, for which it returns a sub-<code>Array</code> of elements
              whose indexes are members of the <code>Range</code>. This is
              computationally quite a different operation to the case with
              <code>Integer</code> arguments, yet the API makes no distinction. A
              clearer case is <code>Dir.[]</code> which interprets its arguments
              as shell globs against the current working directory, returning an
              <code>Array</code> of the matching entries. In this way
              <code>Dir</code> behaves as if it maintains a
              <code>Hash</code>-style mapping from glob to files.

              <p>As alluded to with <code>Array#[<var>range</var>]</code>, it is
              common for <code>:[]</code> to accept arguments of wildly different
              types and try to produce a sensible result. For example,
              <code>String#[]</code> accepts either an <code>Integer</code>, a
              pair of <code>Integer</code>s, a <code>Range</code>, a
              <code>Regexp</code>, a <code>Regexp</code> and an
              <code>Integer</code>, or a <code>String</code>.</p>

            </dd>
              <figure id=aref-music>
                <figcaption>Examples of how different objects respond to the
                <code>:[]</code> message.
              </figure>
            <dt><code>:[]=</code>
            <dd>
              <p>The assignment counterpart to <code>:[]</code>: the first argument(s)
              describe the slice, and the final argument its new value. It
              is expected that <code><var>obj</var>[<var>key</var>] =
                <var>value</var></code> then <code><var>obj</var>[<var>key</var>] ==
                <var>value</var></code>. For this equivalency to hold,
              <code>:[]=</code> may need to be more restrictive in the arguments it
              accepts than its counterpart because some key forms make unsuitable
              assignment targets. For example, <code>Method#[]</code> calls the
              objectified method with the supplied arguments, but it is unclear what
              it would mean to assign to such a slice, so <code>Method#[]=</code> is
              not defined.

              <p>For example, <code>String#[<var>regexp</var>]=
                <var>value</var></code> assigns <var>value</var> to the portion of
              the <code>String</code> matched by <var>regexp</var>;
              <code>Array#[<var>range</var>]= <var>value</var></code> replaces the
              elements in <var>range</var> with <var>value</var>.  

              <figure id=element-set-selector>
                <figcaption>The <code>:[]=</code> selector assigns the second
                argument to the slice of the receiver described by the first.
              </figure>
            </dd>
            <dt><code>:=~</code>         
            <dd>Matches the receiver with the argument. One of the operands is
            typically a <code>Regexp</code>. This operator is commutative, i.e.
            <code>(<var>a</var> =~ <var>b</var>) == (<var>b</var> =~
              <var>a</var>)</code>. For example, <code>String#=~</code>,
            <code>Regexp#=~</code>, and <code>Symbol#=~</code>. <!-- Describe
            return value -->

            <figure id=equal-tilde-selector>
              <figcaption>The <code>:=~</code> selector matches its
              receiver with its argument.
            </figure>

            <dt><code>:&lt;&lt;</code> <!-- Mutates; behaves differently with
            numerics -->
            <dd>When the receiver is an <code>Integer</code> it is shifted left
            the amount of places specified by the argument. Otherwise, the sole
            argument is appended to the receiver, and the mutated receiver
            returned. For example, <code>Array#&lt;&lt;</code>,
            <code>String#&lt;&lt;</code>, <code>IO#&lt;&lt;</code>, and
            <code>Enumerator::Yielder#&lt;&lt;</code> <!-- Last example doesn't
            return mutated receiver -->.

            <figure id=left-shift-selector>
              <figcaption>The <code>:&lt;&lt;</code> selector typically
              appends the argument to the receiver.
            </figure>
            
            <dt><code>:+</code>
            <dd>
              <p>Sum the receiver with the sole argument, which should be of the
              same class, returning a new object. Whereas <code>:&lt;&lt;</code>
              appends the argument to the receiver, <code>:+</code> combines the
              operands into a new object. For example, <code>Fixnum#+</code>,
              <code>String#+</code>, <code>Array#+</code>.
              
              <p>Addition in this manner is not necessarily commutative when the
              operands are non-numeric. For example, <code>'a' + 'b' != 'b' +
                'a'</code>.

              <figure id=plus-selector>
                <figcaption>The <code>:+</code> selector combines the
                operands into a new object.
              </figure>

            </dd>  
            <dt><code>:*</code>
            <dd>Multiples the receiver by a sole numeric argument, returning the
            result. For example: <code>Fixnum#*</code>, <code>String#*</code>, and
            <code>Array#*</code>.

            <figure id=asterisk-selector>
              <figcaption>The <code>:*</code> selector duplicates the receiver
              by the argument.
            </figure>

            <!-- :/ - only used by Numerics -->
            <!-- String#/ http://redmine.ruby-lang.org/issues/show/2017 -->
            <!-- empty? include?, rewind, initialize, new, coerce -->
          </dl>
        </section>
        
        <section>
          <h1 id=tone>Tone</h1>

          <p>By convention, a selector with a question mark (<code>?</code>) suffix
          denotes that the message poses a polar question to the receiver. Such messages
          are referred to as <dfn title="predicate message">predicates</dfn>.</p>
          <!-- Mention situation when a selector is mirrored by a predicate
          alternative? Lots of File methods fit this pattern. http://groups.google.com/group/ruby-talk-google/msg/cfdd0dca7f70c87e -->

          <figure id=predicate-messages>
            <figcaption>The <code>?</code> suffix often indicates that a
            message is a predicate.
          </figure>

          <p>Following similar convention, a selector with an exclamation mark
          (<code>!</code>) suffix (colloquially called a <i>bang</i>) is used <q>…to
            mark a method as special. It doesn’t necessarily mean that it will be
            destructive or dangerous, but it means that it will require more
            attention than its alternative.</q> <a class=ref
            href=/references#refBROWN09>[Brown, 2009, p. 52]</a>. <q>Usually, the method
            without the exclamation mark returns a modified copy of the object it is
            invoked on, and the one with the exclamation mark is a mutator method
            that alters the object in place.</q> <a class=ref
            href=/references#refFLAN08>[Flanagan &amp; Matsumoto, 2008, p. 7]</a></p>

            <figure id=bang-messages>
              <figcaption>The <code>!</code> suffix often indicates that a
              message will modify the receiver in place, or is otherwise
              “dangerous”.
            </figure>

            <p>Both suffixes are merely <i>conventional</i>, however; they do not
            guarantee that the receiver will respond in the aforementioned
            manner.</p>

            <figure id=question-mark-suffix-non-predicate>
              <figcaption>Selectors with a <code>?</code> suffix need not
              return <code>true</code> or <code>false</code>.
            </figure>
        </section>
        
        <section>
          <h1 id=plurality>Plurality</h1>

          <p>Messages whose selectors are plural generally return an
          <code>Enumerable</code> collection of objects. For example,
          <code>String#bytes</code>, <code>String#chars</code>, and
          <code>String#codepoints</code> return <code>Enumerators</code> which
          yield each byte, character, or codepoint, respectively, in turn.
          Similarly, <code>Object#methods</code>,
          <code>Object#instance_methods</code>,
          <code>Object#instance_variables</code>, and similar methods, return
          <code>Array</code>s of <code>Symbol</code>s.</p>

          <figure id=plural-selector-splat>
            <figcaption>Idiomatically create an <code>Array</code> from a
            plural method with the splat operator
          </figure>

          <p>The plurality of the selector does not imply anything about the
          size of the collection returned, however. For instance, if a
          <code>String</code> is empty <code>String#chars</code> returns an
          empty <code>Enumerator</code>. This property is desirable because it
          allows the returned value to be treated as <code>Enumerable</code>
          regardless of its size.
        <section> <!-- /Plurality --> 

       <!--
       <h4>A Survey of Selectors</h4>
       Enumerable
       :all?, - Determiner, predicate 
       :any?, - Determiner, predicate
       :chunk, 
       :collect, 
       :count, 
       :cycle, 
       :detect, 
       :drop, 
       :drop_while, 
       :each_cons, - String aliases each_#{x} to #{x}s; Enumerable doesn't.
       :each_slice, 
       :each_with_index, 
       :each_with_object,
       :entries, - Plural: implies an enumerable will be returned?
       :find, 
       :find_all, 
       :find_index, 
       :first, 
       :grep, 
       :group_by, 
       :include?, 
       :inject, 
       :join, 
       :map, 
       :max, 
       :max_by, 
       :member?, 
       :min, 
       :min_by, 
       :minmax, 
       :minmax_by, 
       :none?, - Determiner, predicate
       :one?, - Not a determiner, predicate
       :partition, 
       :reduce, 
       :reject, 
       :reverse_each, 
       :select, 
       :slice_before, verb_adverb
       :sort, 
       :sort_by, verb_adverb
       :take, 
       :take_while, verb_conjunction
       :to_a, 
       :zip

       Hash#has_*
       <ol>
         <li>Typically verbs. If message has multiple senses, verbal is most
         likely.
         <li>Nouns imply attribute accessor; don't take block?
       </ol>
       -->
      </section>

      <section>
        <h1 id=responding-messages>Responding to Messages</h1>

        <!-- Is this definition sane? --> <p>An object is said to <i>respond
          to</i> a given selector if it expects to receive it as a message. The
        <code>Kernel#respond_to?(<var>selector</var>)</code> predicate returns
        <code>true</code> if a method is defined with the same name as the
        selector; <code>false</code> otherwise.</p>

        <figure id=respond-to>
          <figcaption>An object <i>responds to</i> selectors for which a
          corresponding method is defined.
        </figure>

        <p>However, by defining <code>method_missing</code> an object may
        respond to a message without having a corresponding method defined,
        making the behaviour of <code>Kernel#respond_to?</code> insufficient.
        The solution is <code>Kernel#respond_to_missing?</code>, which is
        explained later.</p>

        <figure id=respond-to-method-missing>
          <figcaption><code>#respond_to?</code> is not necessarily accurate
          when <code>method_missing</code> has been used.
        </figure>

        <p><code>Kernel#respond_to?</code> ignores private methods by default.
        If it is sent with a second argument of <code>true</code>, private
        methods are included in its search.</p>

        <figure id=respond-to-private>        
          <figcaption><code>:respond_to?</code> ignores private methods by
          default.
        </figure>

        <!-- Object#understand? -->

        <p><code>Kernel#respond_to?</code> is often used to condition a
        message expression on the receiver understanding it. That is, before
        an object is told to perform an operation it is asked whether it is
        able. Normally this procedure is unnecessary because it is known, <i>a
        priori</i>, what messages the object will respond to; however, methods
        that are particularly permissive in their argument handling may find
        it necessary.</p>

        <figure id=send-if-respond-to>
          <pre class=syntax><code><var>receiver</var>.<var>selector</var> if
          <var>receiver</var>.respond_to?(:<var>selector</var>)</code></pre>
          <figcaption>Sending a message only if the receiver responds to it.
        </figure> 
        
        <p>The following example suggests a simplification of this idiom by
        defining <code>Object#send?</code> which returns <code>nil</code> if
        the named method does not exist. In addition to the brevity it
        affords, this approach avoids the aforementioned weakness of
        <code>Kernel#respond_to?</code> with respect to messages handled by <a
          href=#method-missing>Method Missing</a>, by rescuing
        <code>NoMethodError</code> if it occurs.</p>

        <figure id=object-send-p>
          <figcaption>An implementation of <code>Object#send?</code>, which
          returns <code>nil</code> if the named method does not exist.
        </figure>
        
        <p>A closely related related scenario involves wanting to send a
        message unless the receiver is <code>nil</code>. It transpires when
        working with values which shouldn’t be <code>nil</code>, but might be.
        The general solution is one of the following constructs:</p> 
        
        <figure id=ternary-nil-receiver>
          <pre class=syntax><code><var>receiver</var> ?
          <var>receiver</var>.<var>selector</var> : nil</code></pre>
          <figcaption>Using the ternary operator to send a receiver a message
          only if it is true; otherwise return <code>nil</code>.    
        </figure>

        <figure id=and-and-nil-receiver>
          <pre class=syntax><code><var>receiver</var> &amp;&amp;
          <var>receiver</var>.<var>selector</var></code></pre>
          <figcaption>Using the logical and operator to send a receiver a
          message only if it is true. 
        </figure>

        <p>Ruby on Rails defines for this purpose
        <code>Object#try(<var>selector</var>,
          <var>arg<sub>0</sub></var>,…,<var>arg<sub>n</sub></var>)</code>,
        which functions as <code>Object#send</code>, but returns
        <code>nil</code> when the receiver is <code>nil</code>, rather than
        raising a <code>NoMethodError</code>.</p>

        <figure id=object-try>
          <figcaption>An implementation of <code>Object#try</code> derived
          from <a
            href=http://github.com/rails/rails/blob/master/activesupport/lib/active_support/core_ext/object/try.rb>Ruby
            on Rails: Active Support</a>.
        </figure>

        <p><!-- Object#try proxy -->

        <!-- Clarify difference between #respond_to? and
        #instance_methods.include? -->
        <!-- Object#try ticket: http://redmine.ruby-lang.org/issues/show/1122 -->
      </section>

      <!-- #respond_to? and NotImplementedError -->
  </section>
  </body>
</html>    

