<a href=/examples/catch-throw.rb><pre class=syntax><code><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>

<span class="k">def</span> <span class="nf">follow</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="n">chain</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="k">while</span> <span class="n">url</span> <span class="k">do</span>
    <span class="n">url</span> <span class="o">=</span> <span class="kp">catch</span><span class="p">(</span><span class="ss">:redirect</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">chain</span> <span class="o">&lt;&lt;</span> <span class="n">url</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
      <span class="n">resp</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">host</span><span class="p">)</span><span class="o">.</span><span class="n">get</span> <span class="n">url</span><span class="o">.</span><span class="n">path</span>
      <span class="k">case</span> <span class="n">resp</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">to_i</span>
        <span class="k">when</span> <span class="mi">200</span>       <span class="k">then</span> <span class="k">return</span> <span class="n">chain</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; =&gt; &#39;</span><span class="p">)</span>
        <span class="k">when</span> <span class="mi">300</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="mi">400</span> <span class="k">then</span> <span class="kp">throw</span> <span class="ss">:redirect</span><span class="p">,</span> <span class="n">resp</span><span class="o">[</span><span class="s1">&#39;location&#39;</span><span class="o">]</span>
        <span class="k">else</span> <span class="k">raise</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">url</span><span class="si">}</span><span class="s2"> =&gt; </span><span class="si">#{</span><span class="n">resp</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">resp</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">follow</span><span class="p">(</span><span class="s1">&#39;http://w3c.org/html&#39;</span><span class="p">)</span> 
<span class="c1">#=&gt; &quot;http://w3c.org/html =&gt; http://www.w3.org/html =&gt; http://www.w3.org/html/&quot;</span>
</code></pre>
</a>